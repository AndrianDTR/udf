/*********************************************************************
 * Name:      	main.cpp
 * Purpose:   	Implements simple wxWidgets application with GUI
 * 				created using wxFormBuilder.
 * Author:
 * Created:
 * Copyright:
 * License:   	wxWidgets license (www.wxwidgets.org)
 *
 * Notes:		Note that all GUI creation code is implemented in
 * 				gui.cpp source file which is generated by wxFormBuilder.
 *********************************************************************/

#include "main.h"

#include "cdbmanager.h"
#include "dbutils.h"
#include "udfexceptions.h"

#include "udfSettings.h"
#include "locale.h"
// initialize the application
IMPLEMENT_APP(MainApp);

////////////////////////////////////////////////////////////////////////////////
// application class implementation
////////////////////////////////////////////////////////////////////////////////

bool MainApp::OnInit()
{
	bool res = false;
	setlocale(LC_ALL, "C");
	try
	{
		CDbManager* pDbMgr = NULL;
		do
		{
			pDbMgr = CDbManager::Instance();
			// Connection OK
			if(pDbMgr->IsOk())
			{
				break;
			}

			//Cancel pressed
			if(UDF_OK != udfSettings(NULL).ShowModal())
			{
				break;
			}
		}
		while(1);

		SetTopWindow( new udfMainFrameBase( NULL ) );
		GetTopWindow()->Show();
		res = true;
	}
	catch(...)
	{
		ShowWarning(_("Unhandled error has been happened. Program will be closed."));
	}

	// true = enter the main loop
	return res;
}
